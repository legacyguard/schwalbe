{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stripe Webhook Contract",
  "description": "API contract for Stripe webhook processing",
  "type": "object",
  "properties": {
    "webhookPayload": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Webhook event ID"
        },
        "object": {
          "type": "string",
          "enum": ["event"],
          "description": "Object type"
        },
        "type": {
          "type": "string",
          "enum": [
            "checkout.session.completed",
            "invoice.payment_succeeded",
            "customer.subscription.updated",
            "customer.subscription.deleted"
          ],
          "description": "Event type"
        },
        "data": {
          "type": "object",
          "properties": {
            "object": {
              "type": "object",
              "description": "Event data object"
            }
          }
        }
      },
      "required": ["id", "object", "type", "data"]
    },
    "headers": {
      "type": "object",
      "properties": {
        "stripe-signature": {
          "type": "string",
          "description": "Stripe webhook signature for verification"
        },
        "content-type": {
          "type": "string",
          "enum": ["application/json"],
          "description": "Content type header"
        }
      },
      "required": ["stripe-signature"]
    },
    "response": {
      "type": "object",
      "properties": {
        "received": {
          "type": "boolean",
          "description": "Confirmation of webhook receipt"
        },
        "processed": {
          "type": "boolean",
          "description": "Whether the webhook was successfully processed"
        },
        "eventId": {
          "type": "string",
          "description": "Processed event ID"
        }
      },
      "required": ["received"]
    },
    "testScenarios": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "name": { "type": "string" },
          "webhookPayload": { "$ref": "#/properties/webhookPayload" },
          "invalidSignature": { "type": "boolean" },
          "expectedResponse": { "$ref": "#/properties/response" },
          "expectedError": {
            "type": "object",
            "properties": {
              "status": { "type": "number" },
              "message": { "type": "string" }
            },
            "required": ["status", "message"],
            "additionalProperties": false
          },
          "databaseAssertions": { "type": "array", "items": { "type": "string" } }
        },
        "required": ["name"],
        "additionalProperties": false
      }
    },
    "securityRequirements": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "requirement": { "type": "string" },
          "description": { "type": "string" },
          "implementation": { "type": "string" },
          "testValidation": { "type": "string" }
        },
        "required": ["requirement", "description"],
        "additionalProperties": false
      }
    }
  }
}