# i18n & Country Rules - Data Model

## Core i18n Entities

### i18nConfig

- `id: string` - Unique identifier
- `locale: string` - Language locale code (e.g., 'en', 'sk', 'cs')
- `country: string` - Country code (e.g., 'US', 'SK', 'CZ')
- `namespace: string` - Translation namespace ('ui', 'wills', 'family-shield')
- `isActive: boolean` - Whether this configuration is active
- `fallbackLocale: string` - Fallback locale if translation missing
- `lastUpdatedAt: timestamp` - Last configuration update
- `createdAt: timestamp` - Creation time
- `updatedAt: timestamp` - Last update time

### Language

- `code: string` - ISO language code (e.g., 'en', 'sk', 'cs', 'de', 'uk')
- `name: string` - Human-readable language name
- `nativeName: string` - Native language name
- `isRTL: boolean` - Right-to-left language flag
- `pluralRules: object` - Pluralization rules for the language
- `dateFormat: string` - Default date format pattern
- `numberFormat: object` - Number formatting rules
- `isActive: boolean` - Whether language is supported
- `sortOrder: number` - Display order in language selectors

### CountryRule

- `id: string` - Unique identifier
- `countryCode: string` - ISO country code (e.g., 'US', 'SK', 'IS')
- `ruleType: 'replace' | 'remove' | 'minimum' | 'closest'` - Type of rule
- `sourceLanguage: string` - Language to replace/remove (optional)
- `targetLanguage: string` - Language to use as replacement (optional)
- `minimumLanguages: number` - Minimum languages required (default: 4)
- `allowedLanguages: string[]` - List of allowed language codes
- `blockedLanguages: string[]` - List of blocked language codes
- `isActive: boolean` - Whether rule is currently active
- `priority: number` - Rule priority (higher = more important)
- `createdAt: timestamp` - Creation time
- `updatedAt: timestamp` - Last update time

### Translation

- `id: string` - Unique identifier
- `key: string` - Translation key (e.g., 'common.save', 'validation.required')
- `locale: string` - Target language locale
- `namespace: string` - Translation namespace
- `value: string` - Translated text
- `isMachineTranslated: boolean` - Whether generated by machine translation
- `qualityScore: number` - Translation quality score (0-1)
- `reviewedBy: string` - User who reviewed the translation (optional)
- `reviewedAt: timestamp` - Review timestamp (optional)
- `sourceText: string` - Original English text
- `context: string` - Usage context for translators
- `createdAt: timestamp` - Creation time
- `updatedAt: timestamp` - Last update time

### LanguageDetection

- `id: string` - Unique identifier
- `userId: string` - Associated user (optional for anonymous)
- `detectedLocale: string` - Detected language locale
- `detectionMethod: 'browser' | 'ip' | 'user' | 'context'` - How language was detected
- `confidence: number` - Detection confidence (0-1)
- `ipAddress: string` - IP address used for geolocation (optional)
- `userAgent: string` - Browser user agent string
- `acceptLanguage: string` - Accept-Language header value
- `geoCountry: string` - Geolocation country code
- `finalLocale: string` - Final selected locale after rules application
- `timestamp: timestamp` - Detection timestamp

### ComplianceCheck

- `id: string` - Unique identifier
- `countryCode: string` - Country being checked
- `ruleId: string` - Associated rule ID
- `checkType: 'language_count' | 'blocked_language' | 'required_replacement'` - Type of compliance check
- `isCompliant: boolean` - Whether check passed
- `actualValue: any` - Actual value found
- `expectedValue: any` - Expected value according to rules
- `severity: 'error' | 'warning' | 'info'` - Compliance issue severity
- `message: string` - Human-readable compliance message
- `resolvedAt: timestamp` - When issue was resolved (optional)
- `createdAt: timestamp` - Check creation time

## Translation Management Entities

### TranslationRequest

- `id: string` - Unique identifier
- `sourceText: string` - Text to translate
- `sourceLocale: string` - Source language
- `targetLocale: string` - Target language
- `context: string` - Translation context
- `priority: 'low' | 'medium' | 'high'` - Translation priority
- `status: 'pending' | 'processing' | 'completed' | 'failed'` - Request status
- `requestedBy: string` - User who requested translation
- `assignedTo: string` - Translator assigned to request (optional)
- `completedAt: timestamp` - Completion timestamp
- `qualityScore: number` - Final translation quality score
- `createdAt: timestamp` - Request creation time
- `updatedAt: timestamp` - Last update time

### TranslationBatch

- `id: string` - Unique identifier
- `name: string` - Batch name/description
- `sourceLocale: string` - Source language for batch
- `targetLocales: string[]` - Target languages
- `status: 'draft' | 'processing' | 'review' | 'completed'` - Batch status
- `totalKeys: number` - Total translation keys in batch
- `completedKeys: number` - Completed translations
- `createdBy: string` - User who created batch
- `assignedTo: string` - Translator/team assigned
- `deadline: timestamp` - Translation deadline
- `createdAt: timestamp` - Batch creation time
- `updatedAt: timestamp` - Last update time

### GoogleTranslateLog

- `id: string` - Unique identifier
- `requestId: string` - Associated translation request ID
- `sourceText: string` - Text sent to Google Translate
- `targetLanguage: string` - Target language requested
- `translatedText: string` - Response from Google Translate
- `confidence: number` - Google Translate confidence score
- `apiCost: number` - API call cost in credits/units
- `processingTime: number` - API response time in ms
- `errorMessage: string` - Error message if API call failed
- `timestamp: timestamp` - API call timestamp

## Analytics & Monitoring Entities

### i18nAnalytics

- `id: string` - Unique identifier
- `metricType: 'page_views' | 'language_switches' | 'translation_requests' | 'compliance_checks'` - Metric type
- `locale: string` - Associated language locale
- `country: string` - Associated country code
- `value: number` - Metric value
- `context: object` - Additional metric context
- `timestamp: timestamp` - Metric timestamp

### i18nPerformance

- `id: string` - Unique identifier
- `operation: 'locale_load' | 'translation_fetch' | 'language_detection'` - Operation type
- `duration: number` - Operation duration in ms
- `locale: string` - Associated language locale
- `bundleSize: number` - Bundle size in bytes (for locale loads)
- `cacheHit: boolean` - Whether result came from cache
- `errorOccurred: boolean` - Whether error occurred
- `timestamp: timestamp` - Performance measurement time

### i18nError

- `id: string` - Unique identifier
- `errorType: 'missing_key' | 'locale_load_failed' | 'translation_failed' | 'compliance_violation'` - Error type
- `locale: string` - Associated language locale
- `key: string` - Translation key (if applicable)
- `message: string` - Error message
- `stackTrace: string` - Error stack trace
- `userAgent: string` - Browser user agent
- `url: string` - Page URL where error occurred
- `userId: string` - Associated user (optional)
- `resolved: boolean` - Whether error has been resolved
- `timestamp: timestamp` - Error timestamp

## Relations

- i18nConfig 1—N Language (available languages per config)
- i18nConfig 1—N CountryRule (rules per configuration)
- i18nConfig 1—N Translation (translations per config)
- CountryRule 1—N ComplianceCheck (checks per rule)
- Language 1—N Translation (translations per language)
- Language 1—N LanguageDetection (detections per language)
- Translation 1—1 TranslationRequest (request that created translation)
- TranslationBatch 1—N TranslationRequest (requests in batch)
- TranslationRequest 1—N GoogleTranslateLog (API calls per request)
- i18nConfig 1—N i18nAnalytics (analytics per config)
- i18nConfig 1—N i18nPerformance (performance per config)
- i18nConfig 1—N i18nError (errors per config)
